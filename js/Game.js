function onLoaded(){this.bg=new backGround,Laya.stage.addChild(this.bg),this.roleBox=new Laya.Sprite,Laya.stage.addChild(this.roleBox),this.gameInfo=new GameInfo,Laya.stage.addChild(this.gameInfo),this.hero=new role,this.hero.init("hero",0,5,0,30),this.hero.shootInterval=500,this.hero.shootType=1,this.hero.pos(240,500),this.roleBox.addChild(this.hero),resume()}function createEnemy(e,o,t,s){for(var i=0;i<o;i++){var a=Laya.Pool.getItemByClass("role",role);a.init("enemy"+(e+1),1,s,t,this.radius[e]),a.shootType=e,a.pos(400*Math.random()+40,200*Math.random()),this.roleBox.addChild(a)}}function restart(){this.score=0,this.level=0,this.levelUpScore=10,this.bulletLevel=0,this.gameInfo.reset(),this.hero.init("hero",0,5,0,30),this.hero.shootType=1,this.hero.pos(200,500),this.hero.shootInterval=500,this.hero.visible=!0;for(var e=this.roleBox.numChildren-1;e>-1;e--){var o=this.roleBox.getChildAt(e);o!=this.hero&&(o.removeSelf(),o.visible=!0,Laya.Pool.recover("role",o))}resume()}function pause(){Laya.timer.clear(this,onLoop),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,onMouseMove)}function resume(){Laya.stage.on(Laya.Event.MOUSE_MOVE,this,onMouseMove),Laya.timer.frameLoop(1,this,onLoop)}function onMouseMove(){this.hero.pos(Laya.stage.mouseX,Laya.stage.mouseY)}function onLoop(){for(var e=this.roleBox.numChildren-1;e>=0;e--){var o=this.roleBox.getChildAt(e);if(o&&o.speed&&(o.isBullet?1==o.camp?(o.y-=o.speed,1==o.bulletType&&(o.x+=o.speed*Math.sin(o.y))):(o.y+=o.speed,5==o.bulletType&&(o.x+=o.speed*Math.cos(o.x-5))):o.y+=o.speed),(o.y>1e3||!o.visible||o.isBullet&&o.y<-20)&&(o.removeSelf(),o.isBullet=!1,o.visible=!0,Laya.Pool.recover("role",o)),o.shootType>0){var t=Laya.Browser.now();if(t>o.shootTime){o.shootTime=t+o.shootInterval,this.pos=this.bulletPos[o.shootType-1];for(var s=0;s<pos.length;s++){var i=Laya.Pool.getItemByClass("role",role);i=new role;var a="bullet1",h=o.y-o.hitRadius-10+pos[s].y;1==o.camp&&(a="bullet2",h=o.y+o.hitRadius+10+pos[s].y),i.init(a,o.camp,1,-4-o.shootType-Math.floor(this.level/15),1,1),i.isBullet=!0,i.bulletType=o.shootType,i.pos(o.x+pos[s].x,h),this.roleBox.addChild(i)}}}if(!(o.hp<1))for(var l=e-1;l>=0;l--)if(o.visible){var r=this.roleBox.getChildAt(l);if(r.hp>0&&o.camp!=r.camp){var n=role.hitRadius=r.hitRadius;Math.abs(o.x-r.x)<n&&Math.abs(o.y-r.y)<n&&(lostHp(o,1),lostHp(r,1),this.score++,this.gameInfo.score(this.score),this.score>this.levelUpScore&&this.level<15&&(this.level++,this.gameInfo.level(this.level),this.levelUpScore+=5*this.level))}}}this.hero.hp<1&&(Laya.timer.clear(this,onLoop),this.gameInfo.info_label.text="GameOver,分数："+this.score+"\n点击这里重新开始。",this.gameInfo.info_label.once(Laya.Event.CLICK,this,restart));var y=this.level<30?2*this.level:60,p=Math.floor(this.level/6),m=Math.floor(this.level/8),v=Math.floor(this.level/10);Laya.timer.currFrame%(80-y)==0&&createEnemy(0,2+v,3+p,1),Laya.timer.currFrame%(150-4*y)==0&&createEnemy(1,1+v,2+p,2+2*m),Laya.timer.currFrame%(900-4*y)==0&&(createEnemy(2,1,1+p,10+6*m),Laya.SoundManager.playSound("res/sound/enemy3_out.mp3"))}function lostHp(e,o){if(e.hp-=o,2===e.heroType?(this.bulletLevel++,this.hero.shootType=Math.min(Math.floor(this.bulletLevel/2)+1,4),this.hero.shootInterval=500-20*(this.bulletLevel>20?20:this.bulletLevel),e.visible=!1):3===e.heroType&&(this.hero.hp++,this.gameInfo.hp(this.hero.hp),this.hero.hp>10&&(this.hero.hp=10),e.visible=!1),e.hp>0)e.playAction("hit"),e.action="hit";else if(e.isBullet)e.visible=!1;else if(e.playAction("down"),e.action="down","enemy3"==e.type){var t=Math.random()<.7?2:3,s=Laya.Pool.getItemByClass("role",role);s.init("ufo"+(t-1),e.camp,1,1,15,t),s.pos(e.x,e.y),this.roleBox.addChild(s)}e==this.hero&&this.gameInfo.hp(e.hp)}Laya.init(480,852,Laya.WebGL),Laya.stage.scaleMode="showall",Laya.stage.alignH="center",Laya.stage.screenMode="vertical",this.bulletPos=[[{x:0,y:0}],[{x:-15,y:0},{x:15,y:0}],[{x:-30,y:10},{x:-15,y:0},{x:15,y:0},{x:30,y:10}],[{x:-40,y:40},{x:40,y:40},{x:-40,y:40},{x:40,y:40},{x:-30,y:30},{x:30,y:30},{x:-20,y:20},{x:20,y:20},{x:-10,y:10},{x:10,y:10},{x:0,y:0}]],this.level=1,this.score=0,this.levelUpScore=10,this.bulletLevel=0,this.hps=[1,2,10],this.speeds=[3,2,1],this.radius=[15,30,70],this.common=new Common,this.common.setName("夏雨"),this.common.sayHello(),this.roleAni=new Laya.Animation,this.roleAni.loadAtlas("res/atlas/war.atlas",Laya.Handler.create(this,onLoaded));